query GetFollowingPositions(
  $subjectId: numeric!
  $predicateId: numeric!
  $objectId: numeric!
  $positionsLimit: Int
  $positionsOffset: Int
  $positionsOrderBy: [positions_order_by!]
  $positionsWhere: positions_bool_exp
) {
  triples(
    where: {
      _and: [
        { subjectId: { _eq: $subjectId } }
        { predicateId: { _eq: $predicateId } }
        { objectId: { _eq: $objectId } }
      ]
    }
  ) {
    ...FollowMetadata
  }
}

query GetFollowerPositions(
  $subjectId: numeric!
  $predicateId: numeric!
  $address: String!
  $positionsLimit: Int
  $positionsOffset: Int
  $positionsOrderBy: [positions_order_by!]
  $positionsWhere: positions_bool_exp
) {
  triples_aggregate(
    where: {
      _and: [
        { subjectId: { _eq: $subjectId } }
        { predicateId: { _eq: $predicateId } }
        { vault: { positions: { accountId: { _eq: $address } } } }
      ]
    }
  ) {
    ...FollowAggregate
  }
  triples(
    where: {
      _and: [
        { subjectId: { _eq: $subjectId } }
        { predicateId: { _eq: $predicateId } }
        { vault: { positions: { accountId: { _eq: $address } } } }
      ]
    }
  ) {
    ...FollowMetadata
  }
}

# Combined query to get following and followers
query GetConnections(
  $subjectId: numeric!
  $predicateId: numeric!
  $objectId: numeric!
  $addresses: [String!]
  $positionsLimit: Int
  $positionsOffset: Int
  $positionsOrderBy: [positions_order_by!]
  $positionsWhere: positions_bool_exp
) {
  # Following
  following_count: triples_aggregate(
    where: {
      _and: [
        { subjectId: { _eq: $subjectId } }
        { predicateId: { _eq: $predicateId } }
        { objectId: { _eq: $objectId } }
      ]
    }
  ) {
    aggregate {
      count
    }
  }
  following: triples(
    where: {
      _and: [
        { subjectId: { _eq: $subjectId } }
        { predicateId: { _eq: $predicateId } }
        { objectId: { _eq: $objectId } }
      ]
    }
  ) {
    ...FollowMetadata
  }

  # Followers
  followers_count: triples_aggregate(
    where: {
      _and: [
        { subjectId: { _eq: $subjectId } }
        { predicateId: { _eq: $predicateId } }
        { vault: { positions: { accountId: { _in: $addresses } } } }
      ]
    }
  ) {
    aggregate {
      count
    }
  }
  followers: triples(
    where: {
      _and: [
        { subjectId: { _eq: $subjectId } }
        { predicateId: { _eq: $predicateId } }
        { vault: { positions: { accountId: { _in: $addresses } } } }
      ]
    }
  ) {
    ...FollowMetadata
  }
}
